{% extends "base2.html" %}
{% load stamped_tags %}

<!-- 
    NOTE: this is a workaround because the built-in ssi tag doesn't support 
    context variables as arguments. We use ssi to include other html files 
    which contain non-django templates that the django templating system 
    should not attempt to parse. Note that we would use the built-in include 
    tag if we wanted to parse an external template before inclusion.
-->
{% load ssi from future %}

{% block head %}
    {{ block.super }}
    
    <link rel="stylesheet" href="{{ STATIC_URL }}css/profile2.css">
    
    <style>
        {% custom_css "profile" %}
    </style>
{% endblock head %}

{% block main %}
    {{ block.super }}
    
    <div class="profile-header-wrapper">
        <div class="profile-header">
            <div class="profile-content-page">
                <div class="profile-header-body">
                    <div class="innerbg"></div>
                    <div class="profile-header-body-fixedwidth fixedwidth clearfix">
                        <div class="profile-image-large floatleft">
                            <!-- TODO: link to lighthouse with full-resolution profile image -->
                            <img src="{{user.image_url_144}}" />
                        </div>
                        
                        <div class="floatleft profile-section0">
                            <p>
                                <a class='pronounced-title large' href="/{{user.screen_name}}">{{user.name}}</a>
                                <a class='screen-name' href="/{{user.screen_name}}">@{{user.screen_name}}</a>{% if user.location %} / {{user.location}}{% endif %}
                            </p>
                            <p>
                                {{user.bio}}
                            </p>
                            
                            <!-- TODO: FOLLOW button -->
                        </div>
                        
                        <div class="profile-sections">
                            <ol class="profile-nav">
                                <li><a href="#" class="up-arrow"></a></li>
                                <li><a href="#" class="down-arrow"></a></li>
                            </ol>
                            
                            <!-- # followers and # friends -->
                            <div class="profile-section profile-section-default">
                                <div class="floatleft profile-section2">
                                    <p class="number">{{user.num_friends}}</p>
                                    <p>following</p>
                                    
                                    {% with users=friends %}
                                        {% mustache_template "user-gallery" %}
                                    {% endwith %}
                                </div>
                                
                                <div class="floatleft profile-section1">
                                    <p class="number">{{user.num_followers}}</p>
                                    <p>followers</p>
                                    
                                    {% with users=followers %}
                                        {% mustache_template "user-gallery" %}
                                    {% endwith %}
                                </div>
                            </div>
                            
                            <!-- stamp distribution -->
                            <div class="profile-section profile-section3">
                                <!--<p class="stamp-category-{{vertical.category}}">
                                    <span class="icon"></span>-->
                                
                                <ul class="user-category-distribution clearfix">
                                {% for vertical in user.distribution %}
                                    <li>
                                        <img src="{{vertical.icon}}" />
                                        <div class="bargraph">
                                            <div class="value"></div>
                                        </div>
                                    </li>
                                {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-header-post">
                    <div class="ribbon-bottom"></div>
                    <div class="inset-stamp">
                        <div class="number">{{user.num_stamps}}</div>
                        <p>STAMPS</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% block stamp_category_nav_bar %}
    <nav id="stamp-category-nav-bar" style="display: block;">
        <ol>
            <li class="default">
                <a class="replaced" href="/{{user.screen_name}}"></a>
                <div></div>
            </li>
            <li class="place">
                <a class="replaced" href="/{{user.screen_name}}?category=place"></a>
                <div></div>
            </li>
            <li class="music">
                <a class="replaced" href="/{{user.screen_name}}?category=music"></a>
                <div></div>
            </li>
            <li class="book">
                <a class="replaced" href="/{{user.screen_name}}?category=book"></a>
                <div></div>
            </li>
            <li class="film">
                <a class="replaced" href="/{{user.screen_name}}?category=film"></a>
                <div></div>
            </li>
            <li class="other">
                <a class="replaced" href="/{{user.screen_name}}?category=other"></a>
                <div></div>
            </li>
        </ol>
    </nav>
    {% endblock stamp_category_nav_bar %}
    
    {% block pre_profile_main_content %}
    <div id="main-content" class="fixedwidth">
        {% endblock pre_profile_main_content %}
        
        {% block profile_main_content %}
            {% handlebars_template "stamp-gallery2" %}
        {% endblock profile_main_content %}
        
        {% block post_profile_main_content %}
    </div>
    {% endblock post_profile_main_content %}
{% endblock main %}

{% block scripts %}
    {{ block.super }}
     
     <!-- jQuery plugins -->
    <script src="{{ STATIC_URL }}js/libs/jquery.infinitescroll{% if IS_PROD %}.min{% endif %}.js"></script>
    <script src="{{ STATIC_URL }}js/libs/jquery.isotope{% if IS_PROD %}.min{% endif %}.js"></script>
    <script src="{{ STATIC_URL }}js/libs/jquery.emoji.js"></script>
    <script src="{{ STATIC_URL }}js/libs/jquery-easing.js"></script>
    <script src="{{ STATIC_URL }}js/libs/history/jquery.history.js"></script>
    
    <script src="{{ STATIC_URL }}js/libs/moment{% if IS_PROD %}.min{% endif %}.js"></script>
    <script src="{{ STATIC_URL }}js/libs/handlebars.js"></script>
    <script src="{{ STATIC_URL }}js/client.js"></script>
    <script src="{{ STATIC_URL }}js/profile2.js"></script>
    
    <script>
        $(document).ready(function() {
            $('.innerbg').css({
                position : 'absolute', 
                width    : '100%', 
                height   : '100%', 
                opacity  : '0.45', 
                background  : 'url("https://maps.googleapis.com/maps/api/staticmap?sensor=false&scale=1&format=png&maptype=roadmap&size=400x200{% if main_stamp_cluster.markers %}{% for marker in main_stamp_cluster.markers %}&markers=%7C{{marker}}{% endfor %}{% endif %}") no-repeat fixed left -75px', 
                'background-size': '100%', 
            }).addClass('blur_8');
        });
    </script>
    
    {% ssi STAMPED_TEMPLATE_FILE %}
{% endblock scripts %}

