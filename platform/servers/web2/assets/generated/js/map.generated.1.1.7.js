if(typeof(Handlebars)=="undefined"){var Handlebars={};Handlebars.VERSION="1.0.beta.6";Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(name,fn,inverse){if(inverse){fn.not=inverse}this.helpers[name]=fn};Handlebars.registerPartial=function(name,str){this.partials[name]=str};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2){return undefined}else{throw new Error("Could not find property '"+arg+"'")}});var toString=Object.prototype.toString,functionType="[object Function]";
Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var ret="";var type=toString.call(context);if(type===functionType){context=context.call(this)}if(context===true){return fn(this)}else{if(context===false||context==null){return inverse(this)}else{if(type==="[object Array]"){if(context.length>0){for(var i=0,j=context.length;i<j;i++){ret=ret+fn(context[i])}}else{ret=inverse(this)}return ret}else{return fn(context)}}}});Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;
var ret="";if(context&&context.length>0){for(var i=0,j=context.length;i<j;i++){ret=ret+fn(context[i])}}else{ret=inverse(this)}return ret});Handlebars.registerHelper("if",function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this)}if(!context||Handlebars.Utils.isEmpty(context)){return options.inverse(this)}else{return options.fn(this)}});Handlebars.registerHelper("unless",function(context,options){var fn=options.fn,inverse=options.inverse;options.fn=inverse;options.inverse=fn;
return Handlebars.helpers["if"].call(this,context,options)});Handlebars.registerHelper("with",function(context,options){return options.fn(context)});Handlebars.registerHelper("log",function(context){Handlebars.log(context)});var handlebars=(function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;
switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0]);break;case 4:this.$=new yy.ProgramNode([]);break;case 5:this.$=[$$[$0]];break;case 6:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 7:this.$=new yy.InverseNode($$[$0-2],$$[$0-1],$$[$0]);break;case 8:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0]);break;case 9:this.$=$$[$0];break;case 10:this.$=$$[$0];break;case 11:this.$=new yy.ContentNode($$[$0]);break;case 12:this.$=new yy.CommentNode($$[$0]);
break;case 13:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 14:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 15:this.$=$$[$0-1];break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 18:this.$=new yy.PartialNode($$[$0-1]);break;case 19:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 20:break;case 21:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];break;case 22:this.$=[[$$[$0-1]].concat($$[$0]),null];
break;case 23:this.$=[[$$[$0-1]],$$[$0]];break;case 24:this.$=[[$$[$0]],null];break;case 25:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 26:this.$=[$$[$0]];break;case 27:this.$=$$[$0];break;case 28:this.$=new yy.StringNode($$[$0]);break;case 29:this.$=new yy.IntegerNode($$[$0]);break;case 30:this.$=new yy.BooleanNode($$[$0]);break;case 31:this.$=new yy.HashNode($$[$0]);break;case 32:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 33:this.$=[$$[$0]];break;case 34:this.$=[$$[$0-2],$$[$0]];break;case 35:this.$=[$$[$0-2],new yy.StringNode($$[$0])];
break;case 36:this.$=[$$[$0-2],new yy.IntegerNode($$[$0])];break;case 37:this.$=[$$[$0-2],new yy.BooleanNode($$[$0])];break;case 38:this.$=new yy.IdNode($$[$0]);break;case 39:$$[$0-2].push($$[$0]);this.$=$$[$0-2];break;case 40:this.$=[$$[$0]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function parseError(str,hash){throw new Error(str)
},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n
}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol==null){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state]){if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")
}}var errStr="";if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+this.terminals_[symbol]+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0] instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)
}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0){recovering--}}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};
r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=(function(){var lexer=({EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError){this.yy.parseError(str,hash)
}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines){this.yylineno++}this._input=this._input.slice(1);return ch},unput:function(ch){this._input=ch+this._input;
return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"
},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-1:this.yylloc.last_column+match[0].length};
this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token){return token}else{return}}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();
if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}});lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;
switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-1)!=="\\"){this.begin("mu")}if(yy_.yytext.slice(-1)==="\\"){yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1),this.begin("emu")}if(yy_.yytext){return 14}break;case 1:return 14;break;case 2:this.popState();return 14;break;case 3:return 24;break;case 4:return 16;break;case 5:return 20;break;case 6:return 19;break;case 7:return 19;break;case 8:return 23;break;case 9:return 23;break;case 10:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.popState();return 15;
break;case 11:return 22;break;case 12:return 34;break;case 13:return 33;break;case 14:return 33;break;case 15:return 36;break;case 16:break;case 17:this.popState();return 18;break;case 18:this.popState();return 18;break;case 19:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 28;break;case 20:return 30;break;case 21:return 30;break;case 22:return 29;break;case 23:return 33;break;case 24:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 33;break;case 25:return"INVALID";break;case 26:return 5;
break}};lexer.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/];lexer.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:false},emu:{rules:[2],inclusive:false},INITIAL:{rules:[0,1,26],inclusive:true}};
return lexer})();parser.lexer=lexer;return parser})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=handlebars;exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)};exports.main=function commonjsMain(args){if(!args[1]){throw new Error("Usage: "+args[0]+" FILE")}if(typeof process!=="undefined"){var source=require("fs").readFileSync(require("path").join(process.cwd(),args[1]),"utf8")}else{var cwd=require("file").path(require("file").cwd());var source=cwd.join(args[1]).read({charset:"utf-8"})
}return exports.parser.parse(source)};if(typeof module!=="undefined"&&require.main===module){exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args)}}Handlebars.Parser=handlebars;Handlebars.parse=function(string){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(string)};Handlebars.print=function(ast){return new Handlebars.PrintVisitor().accept(ast)};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,str){}};Handlebars.log=function(level,str){Handlebars.logger.log(level,str)
};(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse){this.inverse=new Handlebars.AST.ProgramNode(inverse)}};Handlebars.AST.MustacheNode=function(params,hash,unescaped){this.type="mustache";this.id=params[0];this.params=params.slice(1);this.hash=hash;this.escaped=!unescaped};Handlebars.AST.PartialNode=function(id,context){this.type="partial";this.id=id;this.context=context};var verifyMatch=function(open,close){if(open.original!==close.original){throw new Handlebars.Exception(open.original+" doesn't match "+close.original)
}};Handlebars.AST.BlockNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program};Handlebars.AST.InverseNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="inverse";this.mustache=mustache;this.program=program};Handlebars.AST.ContentNode=function(string){this.type="content";this.string=string};Handlebars.AST.HashNode=function(pairs){this.type="hash";this.pairs=pairs};Handlebars.AST.IdNode=function(parts){this.type="ID";
this.original=parts.join(".");var dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part===".."){depth++}else{if(part==="."||part==="this"){this.isScoped=true}else{dig.push(part)}}}this.parts=dig;this.string=dig.join(".");this.depth=depth;this.isSimple=(dig.length===1)&&(depth===0)};Handlebars.AST.StringNode=function(string){this.type="STRING";this.string=string};Handlebars.AST.IntegerNode=function(integer){this.type="INTEGER";this.integer=integer};Handlebars.AST.BooleanNode=function(bool){this.type="BOOLEAN";
this.bool=bool};Handlebars.AST.CommentNode=function(comment){this.type="comment";this.comment=comment}})();Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var p in tmp){if(tmp.hasOwnProperty(p)){this[p]=tmp[p]}}this.message=tmp.message};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};(function(){var escape={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};
var badChars=/&(?!\w+;)|[<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString()}else{if(string==null||string===false){return""}}if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)},isEmpty:function(value){if(typeof value==="undefined"){return true}else{if(value===null){return true}else{if(value===false){return true}else{if(Object.prototype.toString.call(value)==="[object Array]"&&value.length===0){return true
}else{return false}}}}}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(Compiler,JavaScriptCompiler){Compiler.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16};Compiler.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1};
Compiler.DISASSEMBLE_MAP={};for(var prop in Compiler.OPCODE_MAP){var value=Compiler.OPCODE_MAP[prop];Compiler.DISASSEMBLE_MAP[value]=prop}Compiler.multiParamSize=function(code){return Compiler.MULTI_PARAM_OPCODES[Compiler.DISASSEMBLE_MAP[code]]};Compiler.prototype={compiler:Compiler,disassemble:function(){var opcodes=this.opcodes,opcode,nextCode;var out=[],str,name,value;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode==="DECLARE"){name=opcodes[++i];value=opcodes[++i];out.push("DECLARE "+name+" = "+value)
}else{str=Compiler.DISASSEMBLE_MAP[opcode];var extraParams=Compiler.multiParamSize(opcode);var codes=[];for(var j=0;j<extraParams;j++){nextCode=opcodes[++i];if(typeof nextCode==="string"){nextCode='"'+nextCode.replace("\n","\\n")+'"'}codes.push(nextCode)}str=str+" "+codes.join(" ");out.push(str)}}return out.join("\n")},guid:0,compile:function(program,options){this.children=[];this.depths={list:[]};this.options=options;var knownHelpers=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};
if(knownHelpers){for(var name in knownHelpers){this.options.knownHelpers[name]=knownHelpers[name]}}return this.program(program)},accept:function(node){return this[node.type](node)},program:function(program){var statements=program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement)}this.isSimple=l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b});return this},compileProgram:function(program){var result=new this.compiler().compile(program,this.options);
var guid=this.guid++;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2){continue}else{this.addDepth(depth-1)}}return guid},block:function(block){var mustache=block.mustache;var depth,child,inverse,inverseGuid;var params=this.setupStackForMustache(mustache);var programGuid=this.compileProgram(block.program);if(block.program.inverse){inverseGuid=this.compileProgram(block.program.inverse);this.declare("inverse",inverseGuid)
}this.opcode("invokeProgram",programGuid,params.length,!!mustache.hash);this.declare("inverse",null);this.opcode("append")},inverse:function(block){var params=this.setupStackForMustache(block.mustache);var programGuid=this.compileProgram(block.program);this.declare("inverse",programGuid);this.opcode("invokeProgram",null,params.length,!!block.mustache.hash);this.declare("inverse",null);this.opcode("append")},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode("push","{}");for(var i=0,l=pairs.length;
i<l;i++){pair=pairs[i];val=pair[1];this.accept(val);this.opcode("assignToHash",pair[0])}},partial:function(partial){var id=partial.id;this.usePartial=true;if(partial.context){this.ID(partial.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",id.original);this.opcode("append")},content:function(content){this.opcode("appendContent",content.string)},mustache:function(mustache){var params=this.setupStackForMustache(mustache);this.opcode("invokeMustache",params.length,mustache.id.original,!!mustache.hash);
if(mustache.escaped&&!this.options.noEscape){this.opcode("appendEscaped")}else{this.opcode("append")}},ID:function(id){this.addDepth(id.depth);this.opcode("getContext",id.depth);this.opcode("lookupWithHelpers",id.parts[0]||null,id.isScoped||false);for(var i=1,l=id.parts.length;i<l;i++){this.opcode("lookup",id.parts[i])}},STRING:function(string){this.opcode("pushString",string.string)},INTEGER:function(integer){this.opcode("push",integer.integer)},BOOLEAN:function(bool){this.opcode("push",bool.bool)},comment:function(){},pushParams:function(params){var i=params.length,param;
while(i--){param=params[i];if(this.options.stringParams){if(param.depth){this.addDepth(param.depth)}this.opcode("getContext",param.depth||0);this.opcode("pushStringParam",param.string)}else{this[param.type](param)}}},opcode:function(name,val1,val2,val3){this.opcodes.push(Compiler.OPCODE_MAP[name]);if(val1!==undefined){this.opcodes.push(val1)}if(val2!==undefined){this.opcodes.push(val2)}if(val3!==undefined){this.opcodes.push(val3)}},declare:function(name,value){this.opcodes.push("DECLARE");this.opcodes.push(name);
this.opcodes.push(value)},addDepth:function(depth){if(depth===0){return}if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth)}},setupStackForMustache:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash){this.hash(mustache.hash)}this.ID(mustache.id);return params}};JavaScriptCompiler.prototype={nameLookup:function(parent,name,type){if(/^[0-9]+$/.test(name)){return parent+"["+name+"]"}else{if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return parent+"."+name
}else{return parent+"['"+name+"']"}}},appendToBuffer:function(string){if(this.environment.isSimple){return"return "+string+";"}else{return"buffer += "+string+";"}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options||{};this.name=this.environment.name;this.isChild=!!context;this.context=context||{programs:[],aliases:{self:"this"},registers:{list:[]}};this.preamble();this.stackSlot=0;
this.stackVars=[];this.compileChildren(environment,options);var opcodes=environment.opcodes,opcode;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=this.nextOpcode(0);if(opcode[0]==="DECLARE"){this.i=this.i+2;this[opcode[1]]=opcode[2]}else{this.i=this.i+opcode[1].length;this[opcode[0]].apply(this,opcode[1])}}return this.createFunctionContext(asObject)},nextOpcode:function(n){var opcodes=this.environment.opcodes,opcode=opcodes[this.i+n],name,val;var extraParams,codes;if(opcode==="DECLARE"){name=opcodes[this.i+1];
val=opcodes[this.i+2];return["DECLARE",name,val]}else{name=Compiler.DISASSEMBLE_MAP[opcode];extraParams=Compiler.multiParamSize(opcode);codes=[];for(var j=0;j<extraParams;j++){codes.push(opcodes[this.i+j+1+n])}return[name,codes]}},eat:function(opcode){this.i=this.i+opcode.length},preamble:function(){var out=[];this.useRegister("foundHelper");if(!this.isChild){var namespace=this.namespace;var copies="helpers = helpers || "+namespace+".helpers;";if(this.environment.usePartial){copies=copies+" partials = partials || "+namespace+".partials;"
}out.push(copies)}else{out.push("")}if(!this.environment.isSimple){out.push(", buffer = "+this.initializeBuffer())}else{out.push("")}this.lastContext=0;this.source=out},createFunctionContext:function(asObject){var locals=this.stackVars;if(!this.isChild){locals=locals.concat(this.context.registers.list)}if(locals.length>0){this.source[1]=this.source[1]+", "+locals.join(", ")}if(!this.isChild){var aliases=[];for(var alias in this.context.aliases){this.source[1]=this.source[1]+", "+alias+"="+this.context.aliases[alias]
}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,l=this.environment.depths.list.length;i<l;i++){params.push("depth"+this.environment.depths.list[i])}if(asObject){params.push(this.source.join("\n  "));return Function.apply(this,params)}else{var functionSource="function "+(this.name||"")+"("+params.join(",")+") {\n  "+this.source.join("\n  ")+"}";
Handlebars.log(Handlebars.logger.DEBUG,functionSource+"\n\n");return functionSource}},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)))},append:function(){var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){var opcode=this.nextOpcode(1),extra="";this.context.aliases.escapeExpression="this.escapeExpression";
if(opcode[0]==="appendContent"){extra=" + "+this.quotedString(opcode[1][0]);this.eat(opcode)}this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+extra))},getContext:function(depth){if(this.lastContext!==depth){this.lastContext=depth}},lookupWithHelpers:function(name,isScoped){if(name){var topStack=this.nextStack();this.usingKnownHelper=false;var toPush;if(!isScoped&&this.options.knownHelpers[name]){toPush=topStack+" = "+this.nameLookup("helpers",name,"helper");this.usingKnownHelper=true
}else{if(isScoped||this.options.knownHelpersOnly){toPush=topStack+" = "+this.nameLookup("depth"+this.lastContext,name,"context")}else{this.register("foundHelper",this.nameLookup("helpers",name,"helper"));toPush=topStack+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,name,"context")}}toPush+=";";this.source.push(toPush)}else{this.pushStack("depth"+this.lastContext)}},lookup:function(name){var topStack=this.topStack();this.source.push(topStack+" = ("+topStack+" === null || "+topStack+" === undefined || "+topStack+" === false ? "+topStack+" : "+this.nameLookup(topStack,name,"context")+");")
},pushStringParam:function(string){this.pushStack("depth"+this.lastContext);this.pushString(string)},pushString:function(string){this.pushStack(this.quotedString(string))},push:function(name){this.pushStack(name)},invokeMustache:function(paramSize,original,hasHash){this.populateParams(paramSize,this.quotedString(original),"{}",null,hasHash,function(nextStack,helperMissingString,id){if(!this.usingKnownHelper){this.context.aliases.helperMissing="helpers.helperMissing";this.context.aliases.undef="void 0";this.source.push("else if("+id+"=== undef) { "+nextStack+" = helperMissing.call("+helperMissingString+"); }");
if(nextStack!==id){this.source.push("else { "+nextStack+" = "+id+"; }")}}})},invokeProgram:function(guid,paramSize,hasHash){var inverse=this.programExpression(this.inverse);var mainProgram=this.programExpression(guid);this.populateParams(paramSize,null,mainProgram,inverse,hasHash,function(nextStack,helperMissingString,id){if(!this.usingKnownHelper){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";this.source.push("else { "+nextStack+" = blockHelperMissing.call("+helperMissingString+"); }")
}})},populateParams:function(paramSize,helperId,program,inverse,hasHash,fn){var needsRegister=hasHash||this.options.stringParams||inverse||this.options.data;var id=this.popStack(),nextStack;var params=[],param,stringParam,stringOptions;if(needsRegister){this.register("tmp1",program);stringOptions="tmp1"}else{stringOptions="{ hash: {} }"}if(needsRegister){var hash=(hasHash?this.popStack():"{}");this.source.push("tmp1.hash = "+hash+";")}if(this.options.stringParams){this.source.push("tmp1.contexts = [];")}for(var i=0;
i<paramSize;i++){param=this.popStack();params.push(param);if(this.options.stringParams){this.source.push("tmp1.contexts.push("+this.popStack()+");")}}if(inverse){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+inverse+";")}if(this.options.data){this.source.push("tmp1.data = data;")}params.push(stringOptions);this.populateCall(params,id,helperId||id,fn,program!=="{}")},populateCall:function(params,id,helperId,fn,program){var paramString=["depth0"].concat(params).join(", ");var helperMissingString=["depth0"].concat(helperId).concat(params).join(", ");
var nextStack=this.nextStack();if(this.usingKnownHelper){this.source.push(nextStack+" = "+id+".call("+paramString+");")}else{this.context.aliases.functionType='"function"';var condition=program?"foundHelper && ":"";this.source.push("if("+condition+"typeof "+id+" === functionType) { "+nextStack+" = "+id+".call("+paramString+"); }")}fn.call(this,nextStack,helperMissingString,id);this.usingKnownHelper=false},invokePartial:function(context){params=[this.nameLookup("partials",context,"partial"),"'"+context+"'",this.popStack(),"helpers","partials"];
if(this.options.data){params.push("data")}this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(key){var value=this.popStack();var hash=this.topStack();this.source.push(hash+"['"+key+"'] = "+value+";")},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler();this.context.programs.push("");var index=this.context.programs.length;child.index=index;
child.name="program"+index;this.context.programs[index]=compiler.compile(child,options,this.context)}},programExpression:function(guid){if(guid==null){return"self.noop"}var child=this.environment.children[guid],depths=child.depths.list;var programParams=[child.index,child.name,"data"];for(var i=0,l=depths.length;i<l;i++){depth=depths[i];if(depth===1){programParams.push("depth0")}else{programParams.push("depth"+(depth-1))}}if(depths.length===0){return"self.program("+programParams.join(", ")+")"}else{programParams.shift();
return"self.programWithDepth("+programParams.join(", ")+")"}},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";")},useRegister:function(name){if(!this.context.registers[name]){this.context.registers[name]=true;this.context.registers.list.push(name)}},pushStack:function(item){this.source.push(this.nextStack()+" = "+item+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)
}return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(str){return'"'+str.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var reservedWords=("break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield").split(" ");
var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true}JavaScriptCompiler.isValidJavaScriptVariableName=function(name){if(!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name)){return true}return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(string,options){options=options||{};var ast=Handlebars.parse(string);var environment=new Handlebars.Compiler().compile(ast,options);
return new Handlebars.JavaScriptCompiler().compile(environment,options)};Handlebars.compile=function(string,options){options=options||{};var compiled;function compile(){var ast=Handlebars.parse(string);var environment=new Handlebars.Compiler().compile(ast,options);var templateSpec=new Handlebars.JavaScriptCompiler().compile(environment,options,undefined,true);return Handlebars.template(templateSpec)}return function(context,options){if(!compiled){compiled=compile()}return compiled.call(this,context,options)}};
Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data){return Handlebars.VM.program(fn,data)}else{if(programWrapper){return programWrapper}else{programWrapper=this.programs[i]=Handlebars.VM.program(fn);return programWrapper}}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(context,options){options=options||{};
return templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data)}},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args))}},program:function(fn,data){return function(context,options){options=options||{};return fn(context,options.data||data)}},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){options={helpers:helpers,partials:partials,data:data};
if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found")}else{if(partial instanceof Function){return partial(context,options)}else{if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}else{partials[name]=Handlebars.compile(partial);return partials[name](context,options)}}}}};Handlebars.template=Handlebars.VM.template;
/*!
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
}function InfoBox(opt_opts){opt_opts=opt_opts||{};
google.maps.OverlayView.apply(this,arguments);this.content_=opt_opts.content||"";this.disableAutoPan_=opt_opts.disableAutoPan||false;this.maxWidth_=opt_opts.maxWidth||0;this.pixelOffset_=opt_opts.pixelOffset||new google.maps.Size(0,0);this.position_=opt_opts.position||new google.maps.LatLng(0,0);this.zIndex_=opt_opts.zIndex||null;this.boxClass_=opt_opts.boxClass||"infoBox";this.boxStyle_=opt_opts.boxStyle||{};this.closeBoxMargin_=opt_opts.closeBoxMargin||"2px";this.closeBoxURL_=opt_opts.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif";
if(opt_opts.closeBoxURL===""){this.closeBoxURL_=""}this.infoBoxClearance_=opt_opts.infoBoxClearance||new google.maps.Size(1,1);this.isHidden_=opt_opts.isHidden||false;this.alignBottom_=opt_opts.alignBottom||false;this.pane_=opt_opts.pane||"floatPane";this.enableEventPropagation_=opt_opts.enableEventPropagation||false;this.div_=null;this.closeListener_=null;this.moveListener_=null;this.contextListener_=null;this.eventListeners_=null;this.fixedWidthSet_=null}InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.createInfoBoxDiv_=function(){var i;
var events;var bw;var me=this;var cancelHandler=function(e){e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}};var ignoreHandler=function(e){e.returnValue=false;if(e.preventDefault){e.preventDefault()}if(!me.enableEventPropagation_){cancelHandler(e)}};if(!this.div_){this.div_=document.createElement("div");this.setBoxStyle_();if(typeof this.content_.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+this.content_}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(this.content_)
}this.getPanes()[this.pane_].appendChild(this.div_);this.addClickHandler_();if(this.div_.style.width){this.fixedWidthSet_=true}else{if(this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_){this.div_.style.width=this.maxWidth_;this.div_.style.overflow="auto";this.fixedWidthSet_=true}else{bw=this.getBoxWidths_();this.div_.style.width=(this.div_.offsetWidth-bw.left-bw.right)+"px";this.fixedWidthSet_=false}}this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.eventListeners_=[];events=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"];
for(i=0;i<events.length;i++){this.eventListeners_.push(google.maps.event.addDomListener(this.div_,events[i],cancelHandler))}this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(e){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",ignoreHandler);google.maps.event.trigger(this,"domready")}};InfoBox.prototype.getCloseBoxImg_=function(){var img="";if(this.closeBoxURL_!==""){img="<img";img+=" src='"+this.closeBoxURL_+"'";
img+=" align=right";img+=" style='";img+=" position: relative;";img+=" cursor: pointer;";img+=" margin: "+this.closeBoxMargin_+";";img+="'>"}return img};InfoBox.prototype.addClickHandler_=function(){var closeBox;if(this.closeBoxURL_!==""){closeBox=this.div_.firstChild;this.closeListener_=google.maps.event.addDomListener(closeBox,"click",this.getCloseClickHandler_())}else{this.closeListener_=null}};InfoBox.prototype.getCloseClickHandler_=function(){var me=this;return function(e){e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()
}google.maps.event.trigger(me,"closeclick");me.close()}};InfoBox.prototype.panBox_=function(disablePan){var map;var bounds;var xOffset=0,yOffset=0;if(!disablePan){map=this.getMap();if(map instanceof google.maps.Map){if(!map.getBounds().contains(this.position_)){map.setCenter(this.position_)}bounds=map.getBounds();var mapDiv=map.getDiv();var mapWidth=mapDiv.offsetWidth;var mapHeight=mapDiv.offsetHeight;var iwOffsetX=this.pixelOffset_.width;var iwOffsetY=this.pixelOffset_.height;var iwWidth=this.div_.offsetWidth;
var iwHeight=this.div_.offsetHeight;var padX=this.infoBoxClearance_.width;var padY=this.infoBoxClearance_.height;var pixPosition=this.getProjection().fromLatLngToContainerPixel(this.position_);if(pixPosition.x<(-iwOffsetX+padX)){xOffset=pixPosition.x+iwOffsetX-padX}else{if((pixPosition.x+iwWidth+iwOffsetX+padX)>mapWidth){xOffset=pixPosition.x+iwWidth+iwOffsetX+padX-mapWidth}}if(this.alignBottom_){if(pixPosition.y<(-iwOffsetY+padY+iwHeight)){yOffset=pixPosition.y+iwOffsetY-padY-iwHeight}else{if((pixPosition.y+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwOffsetY+padY-mapHeight
}}}else{if(pixPosition.y<(-iwOffsetY+padY)){yOffset=pixPosition.y+iwOffsetY-padY}else{if((pixPosition.y+iwHeight+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwHeight+iwOffsetY+padY-mapHeight}}}if(!(xOffset===0&&yOffset===0)){var c=map.getCenter();map.panBy(xOffset,yOffset)}}}};InfoBox.prototype.setBoxStyle_=function(){var i,boxStyle;if(this.div_){this.div_.className=this.boxClass_;this.div_.style.cssText="";boxStyle=this.boxStyle_;for(i in boxStyle){if(boxStyle.hasOwnProperty(i)){this.div_.style[i]=boxStyle[i]
}}this.div_.style.position="absolute";this.div_.style.visibility="hidden";if(this.zIndex_!==null){this.div_.style.zIndex=this.zIndex_}}};InfoBox.prototype.getBoxWidths_=function(){var computedStyle;var bw={top:0,bottom:0,left:0,right:0};var box=this.div_;if(document.defaultView&&document.defaultView.getComputedStyle){computedStyle=box.ownerDocument.defaultView.getComputedStyle(box,"");if(computedStyle){bw.top=parseInt(computedStyle.borderTopWidth,10)||0;bw.bottom=parseInt(computedStyle.borderBottomWidth,10)||0;
bw.left=parseInt(computedStyle.borderLeftWidth,10)||0;bw.right=parseInt(computedStyle.borderRightWidth,10)||0}}else{if(document.documentElement.currentStyle){if(box.currentStyle){bw.top=parseInt(box.currentStyle.borderTopWidth,10)||0;bw.bottom=parseInt(box.currentStyle.borderBottomWidth,10)||0;bw.left=parseInt(box.currentStyle.borderLeftWidth,10)||0;bw.right=parseInt(box.currentStyle.borderRightWidth,10)||0}}}return bw};InfoBox.prototype.onRemove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);
this.div_=null}};InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var pixPosition=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=(pixPosition.x+this.pixelOffset_.width)+"px";if(this.alignBottom_){this.div_.style.bottom=-(pixPosition.y+this.pixelOffset_.height)+"px"}else{this.div_.style.top=(pixPosition.y+this.pixelOffset_.height)+"px"}if(this.isHidden_){this.div_.style.visibility="hidden"}else{this.div_.style.visibility="visible"}};InfoBox.prototype.setOptions=function(opt_opts){if(typeof opt_opts.boxClass!=="undefined"){this.boxClass_=opt_opts.boxClass;
this.setBoxStyle_()}if(typeof opt_opts.boxStyle!=="undefined"){this.boxStyle_=opt_opts.boxStyle;this.setBoxStyle_()}if(typeof opt_opts.content!=="undefined"){this.setContent(opt_opts.content)}if(typeof opt_opts.disableAutoPan!=="undefined"){this.disableAutoPan_=opt_opts.disableAutoPan}if(typeof opt_opts.maxWidth!=="undefined"){this.maxWidth_=opt_opts.maxWidth}if(typeof opt_opts.pixelOffset!=="undefined"){this.pixelOffset_=opt_opts.pixelOffset}if(typeof opt_opts.alignBottom!=="undefined"){this.alignBottom_=opt_opts.alignBottom
}if(typeof opt_opts.position!=="undefined"){this.setPosition(opt_opts.position)}if(typeof opt_opts.zIndex!=="undefined"){this.setZIndex(opt_opts.zIndex)}if(typeof opt_opts.closeBoxMargin!=="undefined"){this.closeBoxMargin_=opt_opts.closeBoxMargin}if(typeof opt_opts.closeBoxURL!=="undefined"){this.closeBoxURL_=opt_opts.closeBoxURL}if(typeof opt_opts.infoBoxClearance!=="undefined"){this.infoBoxClearance_=opt_opts.infoBoxClearance}if(typeof opt_opts.isHidden!=="undefined"){this.isHidden_=opt_opts.isHidden}if(typeof opt_opts.enableEventPropagation!=="undefined"){this.enableEventPropagation_=opt_opts.enableEventPropagation
}if(this.div_){this.draw()}};InfoBox.prototype.setContent=function(content){this.content_=content;if(this.div_){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(!this.fixedWidthSet_){this.div_.style.width=""}if(typeof content.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+content}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(content)}if(!this.fixedWidthSet_){this.div_.style.width=this.div_.offsetWidth+"px";if(typeof content.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+content
}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(content)}}this.addClickHandler_()}google.maps.event.trigger(this,"content_changed")};InfoBox.prototype.setPosition=function(latlng){this.position_=latlng;if(this.div_){this.draw()}google.maps.event.trigger(this,"position_changed")};InfoBox.prototype.setZIndex=function(index){this.zIndex_=index;if(this.div_){this.div_.style.zIndex=index}google.maps.event.trigger(this,"zindex_changed")};InfoBox.prototype.getContent=function(){return this.content_
};InfoBox.prototype.getPosition=function(){return this.position_};InfoBox.prototype.getZIndex=function(){return this.zIndex_};InfoBox.prototype.show=function(){this.isHidden_=false;if(this.div_){var $div=$(this.div_);$div.css("visibility","visible")}};InfoBox.prototype.hide=function(){this.isHidden_=true;if(this.div_){var $div=$(this.div_);$div.css("visibility","hidden")}};InfoBox.prototype.open=function(map,anchor){var me=this;if(anchor){this.position_=anchor.getPosition();this.moveListener_=google.maps.event.addListener(anchor,"position_changed",function(){me.setPosition(this.getPosition())
})}this.setMap(map)};InfoBox.prototype.close=function(){var i;if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(this.eventListeners_){for(i=0;i<this.eventListeners_.length;i++){google.maps.event.removeListener(this.eventListeners_[i])}this.eventListeners_=null}if(this.moveListener_){google.maps.event.removeListener(this.moveListener_);this.moveListener_=null}if(this.contextListener_){google.maps.event.removeListener(this.contextListener_);this.contextListener_=null
}this.setMap(null)};function ClusterIcon(cluster,styles){cluster.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.cluster_=cluster;this.styles_=styles;this.center_=null;this.div_=null;this.sums_=null;this.visible_=false;this.setMap(cluster.getMap())}ClusterIcon.prototype.onAdd=function(){var cClusterIcon=this;var cMouseDownInCluster;var cDraggingMapByCluster;this.div_=document.createElement("div");if(this.visible_){this.show()}this.getPanes().overlayMouseTarget.appendChild(this.div_);google.maps.event.addListener(this.getMap(),"bounds_changed",function(){cDraggingMapByCluster=cMouseDownInCluster
});google.maps.event.addDomListener(this.div_,"mousedown",function(){cMouseDownInCluster=true;cDraggingMapByCluster=false});google.maps.event.addDomListener(this.div_,"click",function(e){cMouseDownInCluster=false;if(!cDraggingMapByCluster){var mz;var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"click",cClusterIcon.cluster_);google.maps.event.trigger(mc,"clusterclick",cClusterIcon.cluster_);if(mc.getZoomOnClick()){mz=mc.getMaxZoom();mc.getMap().fitBounds(cClusterIcon.cluster_.getBounds());
if(mz!==null&&(mc.getMap().getZoom()>mz)){mc.getMap().setZoom(mz+1)}}e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}}});google.maps.event.addDomListener(this.div_,"mouseover",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseover",cClusterIcon.cluster_)});google.maps.event.addDomListener(this.div_,"mouseout",function(){var mc=cClusterIcon.cluster_.getMarkerClusterer();google.maps.event.trigger(mc,"mouseout",cClusterIcon.cluster_)})};ClusterIcon.prototype.onRemove=function(){if(this.div_&&this.div_.parentNode){this.hide();
google.maps.event.clearInstanceListeners(this.div_);this.div_.parentNode.removeChild(this.div_);this.div_=null}};ClusterIcon.prototype.draw=function(){if(this.visible_){var pos=this.getPosFromLatLng_(this.center_);this.div_.style.top=pos.y+"px";this.div_.style.left=pos.x+"px"}};ClusterIcon.prototype.hide=function(){if(this.div_){this.div_.style.display="none"}this.visible_=false};ClusterIcon.prototype.show=function(){if(this.div_){var pos=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(pos);
if(this.cluster_.printable_){this.div_.innerHTML="<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+"</div>"}else{this.div_.innerHTML=this.sums_.text}this.div_.title=this.cluster_.getMarkerClusterer().getTitle();this.div_.style.display=""}this.visible_=true};ClusterIcon.prototype.useStyle=function(sums){this.sums_=sums;var index=Math.max(0,sums.index-1);index=Math.min(this.styles_.length-1,index);var style=this.styles_[index];this.url_=style.url;
this.height_=style.height;this.width_=style.width;this.anchor_=style.anchor;this.anchorIcon_=style.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];this.textColor_=style.textColor||"black";this.textSize_=style.textSize||11;this.textDecoration_=style.textDecoration||"none";this.fontWeight_=style.fontWeight||"bold";this.fontStyle_=style.fontStyle||"normal";this.fontFamily_=style.fontFamily||"Arial,sans-serif";this.backgroundPosition_=style.backgroundPosition||"0 0"};ClusterIcon.prototype.setCenter=function(center){this.center_=center
};ClusterIcon.prototype.createCss=function(pos){var style=[];if(!this.cluster_.printable_){style.push("background-image:url("+this.url_+");");style.push("background-position:"+this.backgroundPosition_+";")}if(typeof this.anchor_==="object"){if(typeof this.anchor_[0]==="number"&&this.anchor_[0]>0&&this.anchor_[0]<this.height_){style.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;")}else{style.push("height:"+this.height_+"px; line-height:"+this.height_+"px;")}if(typeof this.anchor_[1]==="number"&&this.anchor_[1]>0&&this.anchor_[1]<this.width_){style.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;")
}else{style.push("width:"+this.width_+"px; text-align:center;")}}else{style.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;")}style.push("cursor:pointer; top:"+pos.y+"px; left:"+pos.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+"; text-decoration:"+this.textDecoration_+";");return style.join("")};ClusterIcon.prototype.getPosFromLatLng_=function(latlng){var pos=this.getProjection().fromLatLngToDivPixel(latlng);
pos.x-=this.anchorIcon_[1];pos.y-=this.anchorIcon_[0];return pos};function Cluster(mc){this.markerClusterer_=mc;this.map_=mc.getMap();this.gridSize_=mc.getGridSize();this.minClusterSize_=mc.getMinimumClusterSize();this.averageCenter_=mc.getAverageCenter();this.printable_=mc.getPrintable();this.markers_=[];this.center_=null;this.bounds_=null;this.clusterIcon_=new ClusterIcon(this,mc.getStyles())}Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_
};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){var i;var bounds=new google.maps.LatLngBounds(this.center_,this.center_);var markers=this.getMarkers();for(i=0;i<markers.length;i++){bounds.extend(markers[i].getPosition())}return bounds};Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null);this.markers_=[];delete this.markers_
};Cluster.prototype.addMarker=function(marker){var i;var mCount;var mz;if(this.isMarkerAlreadyAdded_(marker)){return false}if(!this.center_){this.center_=marker.getPosition();this.calculateBounds_()}else{if(this.averageCenter_){var l=this.markers_.length+1;var lat=(this.center_.lat()*(l-1)+marker.getPosition().lat())/l;var lng=(this.center_.lng()*(l-1)+marker.getPosition().lng())/l;this.center_=new google.maps.LatLng(lat,lng);this.calculateBounds_()}}marker.isAdded=true;this.markers_.push(marker);mCount=this.markers_.length;
mz=this.markerClusterer_.getMaxZoom();if(mz!==null&&this.map_.getZoom()>mz){if(marker.getMap()!==this.map_){marker.setMap(this.map_)}}else{if(mCount<this.minClusterSize_){if(marker.getMap()!==this.map_){marker.setMap(this.map_)}}else{if(mCount===this.minClusterSize_){for(i=0;i<mCount;i++){this.markers_[i].setMap(null)}}else{marker.setMap(null)}}}this.updateIcon_();return true};Cluster.prototype.isMarkerInClusterBounds=function(marker){return this.bounds_.contains(marker.getPosition())};Cluster.prototype.calculateBounds_=function(){var bounds=new google.maps.LatLngBounds(this.center_,this.center_);
this.bounds_=this.markerClusterer_.getExtendedBounds(bounds)};Cluster.prototype.updateIcon_=function(){var mCount=this.markers_.length;var mz=this.markerClusterer_.getMaxZoom();if(mz!==null&&this.map_.getZoom()>mz){this.clusterIcon_.hide();return}if(mCount<this.minClusterSize_){this.clusterIcon_.hide();return}var numStyles=this.markerClusterer_.getStyles().length;var sums=this.markerClusterer_.getCalculator()(this.markers_,numStyles);this.clusterIcon_.setCenter(this.center_);this.clusterIcon_.useStyle(sums);
this.clusterIcon_.show()};Cluster.prototype.isMarkerAlreadyAdded_=function(marker){var i;if(this.markers_.indexOf){return this.markers_.indexOf(marker)!==-1}else{for(i=0;i<this.markers_.length;i++){if(marker===this.markers_[i]){return true}}}return false};function MarkerClusterer(map,opt_markers,opt_options){this.extend(MarkerClusterer,google.maps.OverlayView);opt_markers=opt_markers||[];opt_options=opt_options||{};this.markers_=[];this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=false;this.gridSize_=opt_options.gridSize||60;
this.minClusterSize_=opt_options.minimumClusterSize||2;this.maxZoom_=opt_options.maxZoom||null;this.styles_=opt_options.styles||[];this.title_=opt_options.title||"";this.zoomOnClick_=true;if(opt_options.zoomOnClick!==undefined){this.zoomOnClick_=opt_options.zoomOnClick}this.averageCenter_=false;if(opt_options.averageCenter!==undefined){this.averageCenter_=opt_options.averageCenter}this.ignoreHidden_=false;if(opt_options.ignoreHidden!==undefined){this.ignoreHidden_=opt_options.ignoreHidden}this.printable_=false;
if(opt_options.printable!==undefined){this.printable_=opt_options.printable}this.imagePath_=opt_options.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=opt_options.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=opt_options.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=opt_options.calculator||MarkerClusterer.CALCULATOR;this.batchSize_=opt_options.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=opt_options.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;if(navigator.userAgent.toLowerCase().indexOf("msie")!==-1){this.batchSize_=this.batchSizeIE_
}this.setupStyles_();this.addMarkers(opt_markers,true);this.setMap(map)}MarkerClusterer.prototype.onAdd=function(){var cMarkerClusterer=this;this.activeMap_=this.getMap();this.ready_=true;this.repaint();this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){cMarkerClusterer.resetViewport_(false);if(this.getZoom()===0){google.maps.event.trigger(this,"idle")}}),google.maps.event.addListener(this.getMap(),"idle",function(){cMarkerClusterer.redraw_()})]};MarkerClusterer.prototype.onRemove=function(){var i;
for(i=0;i<this.markers_.length;i++){this.markers_[i].setMap(this.activeMap_)}for(i=0;i<this.clusters_.length;i++){this.clusters_[i].remove()}this.clusters_=[];for(i=0;i<this.listeners_.length;i++){google.maps.event.removeListener(this.listeners_[i])}this.listeners_=[];this.activeMap_=null;this.ready_=false};MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){var i,size;if(this.styles_.length>0){return}for(i=0;i<this.imageSizes_.length;i++){size=this.imageSizes_[i];this.styles_.push({url:this.imagePath_+(i+1)+"."+this.imageExtension_,height:size,width:size})
}};MarkerClusterer.prototype.fitMapToMarkers=function(){var i;var markers=this.getMarkers();var bounds=new google.maps.LatLngBounds();for(i=0;i<markers.length;i++){bounds.extend(markers[i].getPosition())}this.getMap().fitBounds(bounds)};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(gridSize){this.gridSize_=gridSize};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinimumClusterSize=function(minimumClusterSize){this.minClusterSize_=minimumClusterSize
};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(maxZoom){this.maxZoom_=maxZoom};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.setStyles=function(styles){this.styles_=styles};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(title){this.title_=title};MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(zoomOnClick){this.zoomOnClick_=zoomOnClick
};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};MarkerClusterer.prototype.setAverageCenter=function(averageCenter){this.averageCenter_=averageCenter};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(ignoreHidden){this.ignoreHidden_=ignoreHidden};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};MarkerClusterer.prototype.setImageExtension=function(imageExtension){this.imageExtension_=imageExtension
};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};MarkerClusterer.prototype.setImagePath=function(imagePath){this.imagePath_=imagePath};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(imageSizes){this.imageSizes_=imageSizes};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(calculator){this.calculator_=calculator};MarkerClusterer.prototype.getPrintable=function(){return this.printable_
};MarkerClusterer.prototype.setPrintable=function(printable){this.printable_=printable};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(batchSizeIE){this.batchSizeIE_=batchSizeIE};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length
};MarkerClusterer.prototype.addMarker=function(marker,opt_nodraw){this.pushMarkerTo_(marker);if(!opt_nodraw){this.redraw_()}};MarkerClusterer.prototype.addMarkers=function(markers,opt_nodraw){var i;for(i=0;i<markers.length;i++){this.pushMarkerTo_(markers[i])}if(!opt_nodraw){this.redraw_()}};MarkerClusterer.prototype.pushMarkerTo_=function(marker){if(marker.getDraggable()){var cMarkerClusterer=this;google.maps.event.addListener(marker,"dragend",function(){if(cMarkerClusterer.ready_){this.isAdded=false;cMarkerClusterer.repaint()
}})}marker.isAdded=false;this.markers_.push(marker)};MarkerClusterer.prototype.removeMarker=function(marker,opt_nodraw){var removed=this.removeMarker_(marker);if(!opt_nodraw&&removed){this.repaint()}return removed};MarkerClusterer.prototype.removeMarkers=function(markers,opt_nodraw){var i,r;var removed=false;for(i=0;i<markers.length;i++){r=this.removeMarker_(markers[i]);removed=removed||r}if(!opt_nodraw&&removed){this.repaint()}return removed};MarkerClusterer.prototype.removeMarker_=function(marker){var i;var index=-1;
if(this.markers_.indexOf){index=this.markers_.indexOf(marker)}else{for(i=0;i<this.markers_.length;i++){if(marker===this.markers_[i]){index=i;break}}}if(index===-1){return false}marker.setMap(null);this.markers_.splice(index,1);return true};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(true);this.markers_=[]};MarkerClusterer.prototype.repaint=function(){var oldClusters=this.clusters_.slice();this.clusters_=[];this.resetViewport_(false);this.redraw_();setTimeout(function(){var i;for(i=0;
i<oldClusters.length;i++){oldClusters[i].remove()}},0)};MarkerClusterer.prototype.getExtendedBounds=function(bounds){var projection=this.getProjection();var tr=new google.maps.LatLng(bounds.getNorthEast().lat(),bounds.getNorthEast().lng());var bl=new google.maps.LatLng(bounds.getSouthWest().lat(),bounds.getSouthWest().lng());var trPix=projection.fromLatLngToDivPixel(tr);trPix.x+=this.gridSize_;trPix.y-=this.gridSize_;var blPix=projection.fromLatLngToDivPixel(bl);blPix.x-=this.gridSize_;blPix.y+=this.gridSize_;
var ne=projection.fromDivPixelToLatLng(trPix);var sw=projection.fromDivPixelToLatLng(blPix);bounds.extend(ne);bounds.extend(sw);return bounds};MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)};MarkerClusterer.prototype.resetViewport_=function(opt_hide){var i,marker;for(i=0;i<this.clusters_.length;i++){this.clusters_[i].remove()}this.clusters_=[];for(i=0;i<this.markers_.length;i++){marker=this.markers_[i];marker.isAdded=false;if(opt_hide){marker.setMap(null)}}};MarkerClusterer.prototype.distanceBetweenPoints_=function(p1,p2){var R=6371;
var dLat=(p2.lat()-p1.lat())*Math.PI/180;var dLon=(p2.lng()-p1.lng())*Math.PI/180;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(p1.lat()*Math.PI/180)*Math.cos(p2.lat()*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d};MarkerClusterer.prototype.isMarkerInBounds_=function(marker,bounds){return bounds.contains(marker.getPosition())};MarkerClusterer.prototype.addToClosestCluster_=function(marker){var i,d,cluster,center;var distance=40000;var clusterToAddTo=null;
for(i=0;i<this.clusters_.length;i++){cluster=this.clusters_[i];center=cluster.getCenter();if(center){d=this.distanceBetweenPoints_(center,marker.getPosition());if(d<distance){distance=d;clusterToAddTo=cluster}}}if(clusterToAddTo&&clusterToAddTo.isMarkerInClusterBounds(marker)){clusterToAddTo.addMarker(marker)}else{cluster=new Cluster(this);cluster.addMarker(marker);this.clusters_.push(cluster)}};MarkerClusterer.prototype.createClusters_=function(iFirst){var i,marker;var mapBounds;var cMarkerClusterer=this;if(!this.ready_){return
}if(iFirst===0){google.maps.event.trigger(this,"clusteringbegin",this);if(typeof this.timerRefStatic!=="undefined"){clearTimeout(this.timerRefStatic);delete this.timerRefStatic}}if(this.getMap().getZoom()>3){mapBounds=new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast())}else{mapBounds=new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625))}var bounds=this.getExtendedBounds(mapBounds);
var iLast=Math.min(iFirst+this.batchSize_,this.markers_.length);for(i=iFirst;i<iLast;i++){marker=this.markers_[i];if(!marker.isAdded&&this.isMarkerInBounds_(marker,bounds)){if(!this.ignoreHidden_||(this.ignoreHidden_&&marker.getVisible())){this.addToClosestCluster_(marker)}}}if(iLast<this.markers_.length){this.timerRefStatic=setTimeout(function(){cMarkerClusterer.createClusters_(iLast)},0)}else{delete this.timerRefStatic;google.maps.event.trigger(this,"clusteringend",this)}};MarkerClusterer.prototype.extend=function(obj1,obj2){return(function(object){var property;
for(property in object.prototype){this.prototype[property]=object.prototype[property]}return this}).apply(obj1,[obj2])};MarkerClusterer.CALCULATOR=function(markers,numStyles){var index=0;var count=markers.length.toString();var dv=count;while(dv!==0){dv=parseInt(dv/10,10);index++}index=Math.min(index,numStyles);return{text:count,index:index}};MarkerClusterer.BATCH_SIZE=2000;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m";
MarkerClusterer.IMAGE_EXTENSION="png";MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90];
/*! map.js
 * 
 * Copyright (c) 2011-2012 Stamped Inc.
 */
(function(){$(document).ready(function(){var canvas=$(".stamp-map .stamp-map-canvas")[0];var $canvas=$(canvas);var lite=STAMPED_PRELOAD.lite;var init_stamp_id=STAMPED_PRELOAD.stamp_id;var center=new google.maps.LatLng(40.707913,-74.013696);var user_pos=null;var stamps=STAMPED_PRELOAD.stamps;var stamps_={};var markers=[];var def_zoom=12;$.each(stamps,function(i,stamp){stamps_[stamp.stamp_id]=stamp
});var get_stamp=function(stamp_id){if(stamps_.hasOwnProperty(stamp_id)){return stamps_[stamp_id]}else{return null}};if(!lite){options={mapTypeId:google.maps.MapTypeId.ROADMAP,center:center,zoom:8,disableDefaultUI:true,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT,position:google.maps.ControlPosition.TOP_RIGHT},panControl:true,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}};var map=new google.maps.Map(canvas,options);var update_map_center=function(pos){if(user_pos!==null){map.setCenter(user_pos);
map.setZoom(14)}else{map.setCenter(pos)}};var image=new google.maps.MarkerImage("/assets/img/pin.png",new google.maps.Size(26,36),new google.maps.Point(0,0),new google.maps.Point(13,30));var shadow=new google.maps.MarkerImage("/assets/img/pin_shadow.png",new google.maps.Size(24,18),new google.maps.Point(0,0),new google.maps.Point(2,17));var stamp_map_popups={};var marker_clusterer=null;var marker_clusterer_enabled=false;var popup=new InfoBox({disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-44,-50),zIndex:null,boxStyle:{width:"340px"},closeBoxMargin:"16px 6px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(2,2),isHidden:false,pane:"floatPane",enableEventPropagation:false,alignBottom:true});
var init_marker_clusterer=function(){if(!!marker_clusterer){return}var minimumClusterSize=4;var gridSize=20;if(stamps.length>minimumClusterSize){marker_clusterer=new MarkerClusterer(map,markers,{minimumClusterSize:minimumClusterSize,gridSize:gridSize,averageCenter:true,maxZoom:def_zoom,title:"Expand Stamp Cluster"});marker_clusterer_enabled=true;google.maps.event.addListener(marker_clusterer,"clusteringend",function(){if(!centered_main_cluster){center_main_cluster=true;resize_map()}})}};var toggle_marker_clusterer=function(){if(!marker_clusterer){init_marker_clusterer()
}else{if(marker_clusterer_enabled){marker_clusterer.setMap(null);marker_clusterer=null;marker_clusterer_enabled=false}else{marker_clusterer.setMap(map);marker_clusterer.resetViewport();marker_clusterer_enabled=true}}};if(stamps.length>0){var coords0=(stamps[0]["entity"]["coordinates"]).split(",");var lat0=parseFloat(coords0[0]);var lng0=parseFloat(coords0[1]);var pos0=new google.maps.LatLng(lat0,lng0);var bounds=new google.maps.LatLngBounds(pos0,pos0);var close_popup=function(){if(!!popup.selected){popup.close();
popup.selected=null}};window.g_close_map_popup=close_popup;google.maps.event.addListener(map,"click",close_popup);google.maps.event.addListener(map,"zoom_changed",close_popup);var partial_templates={};$(".handlebars-template").each(function(i){var $this=$(this);var key=$this.attr("id");var val=$this.html();partial_templates[key]=val});var user_profile_image=function(size){size=(typeof(size)==="undefined"?144:size);var multires_image=this.image;var screen_name=this.screen_name;var name=this.name;var alt=screen_name;
var url="http://static.stamped.com/users/default.jpg";var okay=false;if(!!name){alt=name+"("+alt+")"}if(!!multires_image){for(image in multires_image.sizes){if(image.width===size){url=image.url;okay=true;break}}if(!okay){for(image in multires_image.sizes){url=image.url;okay=true;break}}}if(!okay){console.debug("no image of size '"+size+"' for user '"+screen_name+"'")}return new Handlebars.SafeString('<img alt="'+alt+'" src="'+url+'" />')};Handlebars.registerHelper("user_profile_image",user_profile_image);var template=Handlebars.compile($("#stamp-map-item").html());
$.each(stamps,function(i,stamp){var coords=(stamp.entity["coordinates"]).split(",");var lat=parseFloat(coords[0]);var lng=parseFloat(coords[1]);var pos=new google.maps.LatLng(lat,lng);var title=stamp.entity["title"];var marker=new google.maps.Marker({position:pos,map:map,shadow:shadow,icon:image,shape:null,title:title,zIndex:1});bounds.extend(pos);markers.push(marker);stamp.pos=pos;var popup_content=template(stamp,{partials:partial_templates});var dLat=0.05;var dLng=0.1;var stamp_bounds=new google.maps.LatLngBounds(new google.maps.LatLng(lat-dLat,lng-dLng),new google.maps.LatLng(lat+dLat,lng+dLng));
var open_popup=function(e,should_center){if(popup.selected===marker){close_popup()}else{if(typeof(should_center)!=="undefined"&&!!should_center){if(!map.getBounds().contains(pos)||map.getZoom()<def_zoom){map.fitBounds(stamp_bounds);map.setCenter(pos)}}popup.setContent(popup_content);popup.open(map,marker);if(!!g_update_stamps){setTimeout(function(){var $s=$(".stamp-map-item");$s.find(".close").click(function(event){event.preventDefault();close_popup();return false});if(!lite){$s.click(function(event){if($(event.target).is("a.close")){return true
}return g_open_sdetail_click(event)})}g_update_stamps($s)},150)}popup.selected=marker}if(!!e){e.stop()}};stamp_map_popups[stamp.stamp_id]=open_popup;google.maps.event.addListener(marker,"click",open_popup)})}var open_stamp_map_popup=function(stamp_id){console.debug("open_stamp_map_popup: "+stamp_id);if(!stamp_map_popups.hasOwnProperty(stamp_id)){console.debug("ERROR: couldn't find stamp-list-view-item for stamp_id "+stamp_id);return}else{stamp_map_popups[stamp_id](null,true)}}}var $stamp_map_nav_wrapper=$(".stamp-map-nav-wrapper");
var $list=$stamp_map_nav_wrapper.find(".stamp-list-view");var min_cls="stamp-map-nav-wrapper-collapsed";var list_height_expanded_px=0;var footer_height=0;var center_main_cluster=false;var centered_main_cluster=false;var update_stamp_list_scrollbars=function(){$list.jScrollPane({contentWidth:"0",verticalPadding:8})};var degrees_to_radians=function(x){return x*Math.PI/180};var get_spherical_dist=function(p1,p2){var R=3959;var dLat=degrees_to_radians(p2.lat()-p1.lat());var dLong=degrees_to_radians(p2.lng()-p1.lng());
var b=Math.cos(degrees_to_radians(p1.lat()))*Math.cos(degrees_to_radians(p2.lat()));var a=Math.sin(dLat/2)*Math.sin(dLat/2)+b*Math.sin(dLong/2)*Math.sin(dLong/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return d};var set_temp_max_zoom=function(zoom){var bc=google.maps.event.addListener(map,"idle",function(){if(this.getZoom()>zoom){this.setZoom(zoom)}google.maps.event.removeListener(bc)})};var resize_map=function(){var header_height=$canvas.offset().top||0;var height=(window.innerHeight-header_height);
var height_px=height+"px";$canvas.height(height_px);if(!lite&&!!center_main_cluster&&!centered_main_cluster){if(!!init_stamp_id){var stamp=get_stamp(init_stamp_id);if(!!stamp){center_main_cluster=false;centered_main_cluster=true;map.setCenter(stamp.pos);map.setZoom(14);open_stamp_map_popup(init_stamp_id);if(!!marker_clusterer){marker_clusterer.repaint()}}}else{if(!!marker_clusterer){var init_clusterer=function(depth){if(depth>=2){return}var clusters=marker_clusterer.getClusters();var max_mark=null;var max_pos=null;
var max_size=-1;$.each(clusters,function(i,cluster){var size=cluster.getSize();if(size>max_size){max_size=size;max_mark=cluster.getMarkers();max_pos=cluster.getCenter()}});if(max_pos!==null&&max_size>=4&&(depth==0||max_size>10)){var max_cluster_bounds=new google.maps.LatLngBounds();var total_dist=0;var total_dist2=0;$.each(max_mark,function(i,marker){var pos=marker.getPosition();var dist=get_spherical_dist(max_pos,pos);total_dist+=dist;total_dist2+=dist*dist});var mean=(total_dist/max_size);var stdev=Math.sqrt((total_dist2/max_size)-mean*mean);
var offset=2*stdev;var pts=[];$.each(max_mark,function(i,marker){var pos=marker.getPosition();var dist=get_spherical_dist(max_pos,pos);if(Math.abs(mean-dist)<offset){max_cluster_bounds.extend(pos);pts.push(pos)}});if(pts.length==1){map.setCenter(pts[0])}else{map.fitBounds(max_cluster_bounds)}set_temp_max_zoom(13);if(pts.length>1){marker_clusterer.repaint();init_clusterer(depth+1)}}else{if(depth==0&&max_size>0){set_temp_max_zoom(13)}}};center_main_cluster=false;centered_main_cluster=true;init_clusterer(0)}}}var nav_header_height=$stamp_map_nav_wrapper.find(".nav-header").height();
var list_height=(height-footer_height-24-nav_header_height);var list_height_px=list_height+"px";list_height_expanded_px=list_height_px;if(!$stamp_map_nav_wrapper.hasClass(min_cls)){$list.css({height:list_height_px,"max-height":list_height_px});update_stamp_list_scrollbars()}};$stamp_map_nav_wrapper.find(".nav-footer, .nav-dummy-footer").each(function(i,elem){var $elem=$(elem);var height=$elem.height();if(height>0){footer_height=height;$elem.css({"min-height":height,"max-height":height})}});$(".list-view-nav a").click(function(event){event.preventDefault();
var $this=$(this);var $nav=$this.parents(".stamp-map-nav-wrapper");var $list=$nav.find(".stamp-list-view").stop(true,false);var duration=600;var easing="easeOutCubic";$nav.toggleClass(min_cls);if($nav.hasClass(min_cls)){$nav.parent().css({"pointer-events":"none",});$canvas.addClass("blur-none").removeClass("blur-nohover");$list.animate({height:"0"},{duration:duration,specialEasing:{width:easing,height:easing}})}else{$canvas.removeClass("blur-none").addClass("blur-nohover");$list.animate({height:list_height_expanded_px},{duration:duration,specialEasing:{width:easing,height:easing},complete:function(){update_stamp_list_scrollbars()
}})}return false});var $stamp_list_view_items=$list.find(".stamp-list-view-item");var get_stamp_list_view_item_id=function($elem){var stamp_id=g_extract_data($elem,"stamp-id-",null);if(stamp_id===null){console.debug("ERROR: no stamp_id for stamp-list-view-item: "+$elem)}return stamp_id};$stamp_list_view_items.click(function(event){event.preventDefault();var $this=$(this);var stamp_id=get_stamp_list_view_item_id($this);if(stamp_id!==null){if(lite){var stamp=get_stamp(stamp_id);if(!!stamp&&!!stamp.url&&parent.frames.length>0){var url=stamp.url.replace("http://www.stamped.com","");
top.location=url}}else{open_stamp_map_popup(stamp_id)}}return false});if(!lite){var bounds_changed=function(event){var bounds=map.getBounds();var $to_hide=$([]);var $to_show=$([]);$stamp_list_view_items.each(function(i,elem){var $elem=$(elem);var stamp_id=get_stamp_list_view_item_id($elem);var visible=false;if(stamp_id!==null){var stamp=get_stamp(stamp_id);if(!!stamp){visible=bounds.contains(stamp.pos)}}if(visible){$to_show=$to_show.add($elem)}else{$to_hide=$to_hide.add($elem)}});var duration=200;var easing="easeOutCubic";
var done=0;var complete=function(){if(++done>=2){update_stamp_list_scrollbars()}};$to_show.stop(true,false).slideDown(duration,easing,complete).animate({opacity:1},{duration:duration,easing:easing,queue:false});$to_hide.stop(true,false).slideUp(duration,easing,complete).animate({opacity:0},{duration:duration,easing:easing,queue:false})}}if(!lite&&navigator.geolocation){$("a.my-location").css("display","block").click(function(event){event.stopPropagation();if(user_pos!==null){update_map_center(user_pos)}else{var $this=$(this);
$this.addClass("my-location-loading");var finally_func=function(){$this.removeClass("my-location-loading")};navigator.geolocation.getCurrentPosition(function(position){if(!!position){var lat=position.coords.latitude;var lng=position.coords.longitude;user_pos=new google.maps.LatLng(lat,lng);console.debug("user_pos: "+user_pos);update_map_center(user_pos)}finally_func()},function(){console.debug("ERROR: navigator.geolocation.getCurrentPosition failed!");finally_func()})}return false})}window.addEventListener("resize",resize_map,false);
if(lite){resize_map()}else{$(document).bind("keydown","ctrl+t",function(){toggle_marker_clusterer()});google.maps.event.addListener(map,"idle",bounds_changed);var update_map_bounds=function(){map.fitBounds(bounds);update_map_center(bounds.getCenter())};update_map_bounds();resize_map();init_marker_clusterer();setTimeout(function(){if(typeof(g_init_social_sharing)!=="undefined"){g_init_social_sharing()}},1000)}setTimeout(resize_map,150)})})();